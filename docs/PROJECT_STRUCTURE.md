# EMS Control é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
charge-app/
â”œâ”€â”€ frontend/                    # Tauri å‰ç«¯ (React + Vite)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.tsx             # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ App.css             # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ main.tsx            # å…¥å£æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ assets/             # é™æ€èµ„æº
â”‚   â”œâ”€â”€ src-tauri/
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ main.rs         # Tauri ä¸»è¿›ç¨‹
â”‚   â”‚   â”‚   â””â”€â”€ lib.rs          # Tauri å‘½ä»¤å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ tauri.conf.json     # Tauri é…ç½®
â”‚   â”‚   â””â”€â”€ Cargo.toml          # Rust ä¾èµ–
â”‚   â”œâ”€â”€ public/                 # å…¬å…±èµ„æº
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â””â”€â”€ index.html
â”‚
â”œâ”€â”€ backend/                     # çº¯ Rust æ§åˆ¶æ ¸å¿ƒ (å¯ç‹¬ç«‹è¿è¡Œ)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.rs             # ç¨‹åºå…¥å£ + è®¾å¤‡è½®è¯¢ + æ§åˆ¶ä¸»å¾ªç¯
â”‚   â”‚   â”œâ”€â”€ ems_core.rs         # æ ¸å¿ƒèƒ½é‡è°ƒåº¦ç­–ç•¥ (å…‰ä¼ä¼˜å…ˆ + åŠŸç‡å¹³è¡¡)
â”‚   â”‚   â”œâ”€â”€ can.rs              # CAN è®¾å¤‡é©±åŠ¨ (socketcan + can-frame)
â”‚   â”‚   â”œâ”€â”€ modbus.rs           # Modbus å®¢æˆ·ç«¯ (tokio-modbus)
â”‚   â”‚   â”œâ”€â”€ gps_4g.rs           # 4G + GPS æ¨¡å— (AT æŒ‡ä»¤ä¸²å£)
â”‚   â”‚   â”œâ”€â”€ cloud.rs            # å®šæ—¶ä¸ŠæŠ¥äº‘ç«¯ (MQTT over TLS)
â”‚   â”‚   â”œâ”€â”€ devices/
â”‚   â”‚   â”‚   â”œâ”€â”€ pv_dcdc.rs      # PV DCDC å…‰ä¼è®¾å¤‡
â”‚   â”‚   â”‚   â”œâ”€â”€ bms.rs          # BMS ç”µæ± ç®¡ç†ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ genset.rs       # Genset å‘ç”µæœºè®¾å¤‡
â”‚   â”‚   â”‚   â”œâ”€â”€ charger.rs      # Charger å……ç”µå™¨è®¾å¤‡
â”‚   â”‚   â”‚   â””â”€â”€ pcs.rs          # PCS åŠŸç‡è½¬æ¢ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ types.rs            # ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ Cargo.toml
â”‚
â””â”€â”€ shared/                      # å‰åç«¯å…±äº«ç±»å‹ (å¯é€‰ç”¨ ts-rs)
    â””â”€â”€ types.ts
```

## ğŸ¯ å„æ¨¡å—èŒè´£

### Frontend (Tauri + React)
- **åŠŸèƒ½**: ç”¨æˆ·ç•Œé¢ï¼Œæ˜¾ç¤ºè®¾å¤‡çŠ¶æ€å’Œæ§åˆ¶é¢æ¿
- **æŠ€æœ¯æ ˆ**: React + TypeScript + Vite + Tauri
- **é€šä¿¡**: é€šè¿‡ Tauri invoke è°ƒç”¨ Rust å‘½ä»¤

### Backend (çº¯ Rust)
- **åŠŸèƒ½**: EMS æ§åˆ¶æ ¸å¿ƒï¼Œè®¾å¤‡é€šä¿¡ï¼Œç­–ç•¥æ‰§è¡Œ
- **ç‰¹ç‚¹**: å¯ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ– Tauri
- **é€šä¿¡**: 
  - Modbus TCP â† ä¸è®¾å¤‡é€šä¿¡
  - MQTT (å¯é€‰) â† å‘å¸ƒçŠ¶æ€

### Shared
- **åŠŸèƒ½**: å‰åç«¯å…±äº«çš„ç±»å‹å®šä¹‰
- **å¯é€‰**: ä½¿ç”¨ ts-rs è‡ªåŠ¨ä» Rust ç”Ÿæˆ TypeScript ç±»å‹

## ğŸ“ ä¸‹ä¸€æ­¥

### 1. è¿è¡Œ Frontend (React + Tauri)
```bash
cd frontend
npm install
npm run tauri dev
```

### 3. ç¼–è¯‘ Backend
```bash
cd backend
cargo build
cargo run  # ç‹¬ç«‹è¿è¡Œæµ‹è¯•
```

### 4. è¿è¡Œ Tauri åº”ç”¨
```bash
cd frontend
npm run tauri dev
```

## ğŸ”§ å¼€å‘å»ºè®®

1. **Backend å…ˆè¡Œ**: å…ˆå®ç° backend/ çš„æ ¸å¿ƒé€»è¾‘
2. **ç‹¬ç«‹æµ‹è¯•**: backend/ å¯ä»¥ç‹¬ç«‹è¿è¡Œå’Œè°ƒè¯•
3. **ç±»å‹åŒæ­¥**: ä½¿ç”¨ ts-rs è‡ªåŠ¨åŒæ­¥ç±»å‹å®šä¹‰
4. **æ¸è¿›å¼€å‘**: 
   - å…ˆå®ç° Modbus é€šä¿¡
   - å†å®ç°è®¾å¤‡æŠ½è±¡
   - æœ€åå®Œæˆ EMS æ§åˆ¶ç­–ç•¥

## âš ï¸ æ³¨æ„äº‹é¡¹

- å½“å‰æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯ **placeholder**ï¼Œä»…åŒ…å«æ¡†æ¶å’Œ TODO æ³¨é‡Š
- éœ€è¦æ ¹æ®å®é™…è®¾å¤‡åè®®å¡«å…… Modbus å¯„å­˜å™¨åœ°å€å’Œæ•°æ®æ ¼å¼
- MQTT ä¸ºå¯é€‰åŠŸèƒ½ï¼Œå¯æ ¹æ®éœ€æ±‚å†³å®šæ˜¯å¦å®ç°
